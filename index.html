<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>United Gujaratis of North Texas (UGNT)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Laila:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            position: relative;
        }
        h1, h2, h3, .font-laila {
            font-family: 'Laila', serif;
        }
        /* Simple scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #fdba74; /* orange-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #fb923c; /* orange-400 */
        }
        /* Style for the decorative pattern overlay */
        .pattern-overlay {
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 1rem 1rem;
            opacity: 0.5;
        }
        
        /* Decorative side patterns */
        .side-pattern {
            position: fixed;
            top: 0;
            bottom: 0;
            width: 150px; /* Adjust width as needed */
            background-image: url('data:image/svg+xml,%3csvg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80"%3e%3crect width="80" height="80" fill="%23FFF7ED"/%3e%3cg fill="%23F97316"%3e%3ccircle cx="20" cy="20" r="2"/%3e%3ccircle cx="60" cy="20" r="2"/%3e%3ccircle cx="20" cy="60" r="2"/%3e%3ccircle cx="60" cy="60" r="2"/%3e%3ccircle cx="40" cy="40" r="6" fill-opacity="0.3"/%3e%3c/g%3e%3c/svg%3e');
            background-repeat: repeat;
            z-index: -1;
            opacity: 0.6;
        }
        
        @media (max-width: 1280px) {
            .side-pattern {
                display: none;
            }
        }
        .footer-pattern {
            position: absolute;
            inset: 0;
            background-image: url('data:image/svg+xml,%3csvg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80"%3e%3crect width="80" height="80" fill="%230F172A"/%3e%3cg fill="%23F97316"%3e%3ccircle cx="20" cy="20" r="2"/%3e%3ccircle cx="60" cy="20" r="2"/%3e%3ccircle cx="20" cy="60" r="2"/%3e%3ccircle cx="60" cy="60" r="2"/%3e%3ccircle cx="40" cy="40" r="6" fill-opacity="0.3"/%3e%3c/g%3e%3c/svg%3e');
            background-size: 40px 40px;
            opacity: 0.1;
            z-index: 0;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ugnt-orange': '#F97316', // A vibrant orange
                        'ugnt-blue': '#0F172A',   // A deep, professional blue
                        'ugnt-gold': '#FBBF24',   // A warm gold accent
                        'ugnt-bg': '#FFF7ED',    // A warm, off-white background
                    },
                    fontFamily: {
                        'laila': ['Laila', 'serif'],
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-ugnt-bg text-slate-800">

    <!-- Decorative side patterns -->
    <div class="side-pattern left-0"></div>
    <div class="side-pattern right-0"></div>

    <header class="bg-white sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-2 flex justify-between items-center">
            <a href="#" class="flex-shrink-0" onclick="showPage('home')">
                <img src="ugnt-logo.png" 
                     onerror="this.onerror=null;this.src='https://placehold.co/100x100/FFFFFF/0F172A?text=UGNT';"
                     alt="UGNT Logo" class="h-16 w-16">
            </a>
            <div class="hidden md:flex space-x-8 items-center">
                <a href="#" class="text-slate-600 hover:text-ugnt-orange transition duration-300" onclick="showPage('home')">Home</a>
                <a href="#" class="text-slate-600 hover:text-ugnt-orange transition duration-300" onclick="showPage('events')">Events</a>
                <a href="#" class="text-slate-600 hover:text-ugnt-orange transition duration-300" onclick="showPage('directory')">Directory</a>
                <a href="#" class="bg-ugnt-orange text-white px-4 py-2 rounded-full hover:bg-orange-600 transition duration-300 shadow-md" onclick="showPage('contact')">Submit Business</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-ugnt-blue" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4 space-y-2 bg-white">
            <a href="#" class="block text-slate-600 hover:text-ugnt-orange transition duration-300" onclick="showPage('home')">Home</a>
            <a href="#" class="block text-slate-600 hover:text-ugnt-orange transition duration-300" onclick="showPage('events')">Events</a>
            <a href="#" class="block text-slate-600 hover:text-ugnt-orange transition duration-300" onclick="showPage('directory')">Directory</a>
            <a href="#" class="block bg-ugnt-orange text-white text-center mt-2 px-4 py-2 rounded-full hover:bg-orange-600 transition duration-300 shadow-md" onclick="showPage('contact')">Submit Business</a>
        </div>
    </header>

    <main class="container mx-auto px-6">

        <div id="home" class="page">
            <section class="relative h-[60vh] rounded-2xl overflow-hidden flex items-center justify-center text-center text-white bg-ugnt-blue mt-8">
                <img src="https://images.unsplash.com/photo-1553334490-011441d86dbb?fm=jpg&q=60&w=3000"
                     onerror="this.onerror=null;this.src='https://placehold.co/1200x800/0F172A/FFFFFF?text=UGNT+Community';"
                     alt="Gujarati cultural event" class="absolute inset-0 w-full h-full object-cover">
                <div class="absolute inset-0 bg-black opacity-60 z-10"></div>
                <div class="absolute inset-0 pattern-overlay z-10"></div>
                <div class="relative z-20 p-4">
                    <h1 class="text-4xl md:text-6xl font-bold font-laila leading-tight">United Gujaratis of North Texas</h1>
                    <p class="mt-4 text-lg md:text-xl max-w-2xl mx-auto">Connecting, celebrating, and strengthening the Gujarati community in the DFW Metroplex.</p>
                </div>
            </section>

            <section class="py-16 md:py-24 text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-ugnt-blue">Our Mission</h2>
                <div class="max-w-3xl mx-auto mt-6">
                    <p class="text-slate-600 text-lg">
                        UGNT is dedicated to fostering a vibrant and supportive network for Gujaratis in North Texas. We aim to preserve our rich cultural heritage, promote community engagement through social and cultural events, and support the growth of local Gujarati-owned businesses. Join us in building a stronger community together!
                    </p>
                </div>
            </section>
            
            <div class="py-8">
                <svg width="100%" height="40" viewBox="0 0 1440 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-orange-100">
                    <path d="M0 20C240 20 240 0 480 0C720 0 720 20 960 20C1200 20 1200 40 1440 40V41H0V20Z" fill="currentColor"/>
                </svg>
            </div>

        </div>

        <div id="events" class="page hidden py-8 md:py-12">
            <h2 class="text-3xl md:text-4xl font-bold text-ugnt-blue mb-8 text-center">Community Events</h2>
            <div id="events-loading" class="text-center text-slate-500">
                <p>Loading events...</p>
            </div>
            <div id="events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
        </div>

        <div id="directory" class="page hidden py-8 md:py-12">
            <h2 class="text-3xl md:text-4xl font-bold text-ugnt-blue mb-8 text-center">Business Directory</h2>
            <div class="mb-8 p-6 bg-white rounded-xl shadow-md">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="directory-search" placeholder="Search by name, category..." class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition">
                    <select id="directory-filter" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition">
                        <option value="">All Categories</option>
                        </select>
                </div>
            </div>
            <div id="directory-loading" class="text-center text-slate-500">
                <p>Loading directory...</p>
            </div>
            <div id="directory-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
            <div id="directory-no-results" class="hidden text-center text-slate-500 py-12">
                <p>No businesses found matching your criteria.</p>
            </div>
        </div>

        <div id="contact" class="page hidden py-8 md:py-12">
            <div class="max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl md:text-4xl font-bold text-ugnt-blue mb-2 text-center">Join Our Directory</h2>
                <p class="text-center text-slate-500 mb-8">Submit your business details to be featured in our community directory. Submissions will be reviewed by an admin before appearing on the site.</p>
                
                <form id="business-form" class="space-y-6">
                    <div>
                        <label for="business-name" class="block text-sm font-medium text-slate-700">Business Name</label>
                        <input type="text" id="business-name" name="businessName" required class="mt-1 block w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition">
                    </div>
                    <div>
                        <label for="owner-name" class="block text-sm font-medium text-slate-700">Owner Name</label>
                        <input type="text" id="owner-name" name="ownerName" required class="mt-1 block w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition">
                    </div>
                    <div>
                        <label for="contact-info" class="block text-sm font-medium text-slate-700">Contact Info (Phone or Email)</label>
                        <input type="text" id="contact-info" name="contactInfo" required class="mt-1 block w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition">
                    </div>
                     <div>
                        <label for="description" class="block text-sm font-medium text-slate-700">Short Description</label>
                        <textarea id="description" name="description" rows="3" required class="mt-1 block w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition"></textarea>
                    </div>
                    <div>
                        <label for="website-link" class="block text-sm font-medium text-slate-700">Website Link (optional)</label>
                        <input type="url" id="website-link" name="websiteLink" placeholder="https://example.com" class="mt-1 block w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition">
                    </div>
                    <div>
                        <label for="category" class="block text-sm font-medium text-slate-700">Category</label>
                        <input type="text" id="category" name="category" required placeholder="e.g., Restaurant, IT Services, Retail" class="mt-1 block w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-ugnt-orange focus:border-transparent transition">
                    </div>
                    <div class="text-center">
                        <button type="submit" id="submit-button" class="bg-ugnt-orange text-white px-8 py-3 rounded-full hover:bg-orange-600 transition duration-300 shadow-md font-bold text-lg w-full md:w-auto">Submit for Review</button>
                    </div>
                </form>
                <div id="form-status" class="mt-6 text-center text-lg"></div>
            </div>
        </div>

    </main>

    <footer class="bg-ugnt-blue text-white mt-16 pt-12 relative overflow-hidden">
        <div class="footer-pattern"></div>
        <div class="absolute top-0 left-0 right-0 -mt-px">
            <svg width="100%" height="60" viewBox="0 0 1440 60" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
                <path d="M0 60V0C480 20 960 20 1440 0V60H0Z" fill="#FB923C" fill-opacity="0.2"></path>
                <path d="M0 60V15C480 35 960 35 1440 15V60H0Z" fill="#FB923C" fill-opacity="0.3"></path>
                <path d="M0 60V30C480 50 960 50 1440 30V60H0Z" fill="#FB923C" fill-opacity="0.4"></path>
            </svg>
        </div>
        <div class="container mx-auto px-6 py-8 text-center relative z-10">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#" class="hover:text-ugnt-gold transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M22.675 0h-21.35c-.732 0-1.325.593-1.325 1.325v21.351c0 .731.593 1.324 1.325 1.324h11.494v-9.294h-3.128v-3.622h3.128v-2.671c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12v9.293h6.116c.73 0 1.323-.593 1.323-1.325v-21.35c0-.732-.593-1.325-1.325-1.325z"/></svg>
                </a>
                <a href="#" class="hover:text-ugnt-gold transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919 4.919 1.266-.058 1.644-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.441 1.441 1.441 1.441-.645 1.441-1.441-.645-1.44-1.441-1.44z"/></svg>
                </a>
            </div>
            <p class="text-slate-400">&copy; <span id="copyright-year"></span> United Gujaratis of North Texas. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const EVENTS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ1m1KPD10bseeiTHrJPZrTZrymnuDY19jPVtDCCR1mDmcprXOcDtjyhbDMo6QhmsF2cE1NHhjusvQG/pub?output=csv';
        const DIRECTORY_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSSJoSgPzAMs1P9bTEYhvAeV9vAhKYFr-4ChQvUw83wQu9QC-ChYxTBRWm_kE3iRHy-TzJPfD-1gglu/pub?output=csv';
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby52j60xdTxSeHiWNfyZ0rcIWPNJVQe5pyDtk_nhVQqKGBvETPtTrWJd_3WEPhXVQgbqw/exec';

        // --- PAGE NAVIGATION ---
        const pages = document.querySelectorAll('.page');
        function showPage(pageId) {
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.remove('hidden');
                } else {
                    page.classList.add('hidden');
                }
            });
            window.scrollTo(0, 0);
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        // --- MOBILE MENU TOGGLE ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- DYNAMIC DATA LOADING ---
        document.addEventListener('DOMContentLoaded', () => {
            loadEvents();
            loadDirectory();
            document.getElementById('copyright-year').textContent = new Date().getFullYear();
            
            const businessForm = document.getElementById('business-form');
            businessForm.addEventListener('submit', handleFormSubmit);
        });

        /**
         * --- CSV PARSER ---
         */
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            if (lines.length < 2) return [];
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const rows = [];

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i]) continue;
                const obj = {};
                const values = lines[i].match(/(".*?"|[^",\r]+)(?=\s*,|\s*$)/g) || [];

                for (let j = 0; j < headers.length; j++) {
                    let value = values[j] || '';
                    if (value.startsWith('"') && value.endsWith('"')) {
                        value = value.slice(1, -1);
                    }
                    obj[headers[j]] = value.trim();
                }
                rows.push(obj);
            }
            return rows;
        }

        // --- EVENTS LOGIC ---
        async function loadEvents() {
            const loadingEl = document.getElementById('events-loading');
            try {
                const response = await fetch(EVENTS_CSV_URL);
                if (!response.ok) throw new Error('Network response was not ok.');
                const csvText = await response.text();
                const data = parseCSV(csvText);

                const events = data.map(row => ({
                    title: row['Event Title'],
                    date: row['Date'],
                    description: row['Description'],
                    imageUrl: row['Image URL']
                })).filter(event => event.title);
                
                renderEvents(events);
            } catch (error) {
                console.error('Error fetching events:', error);
                loadingEl.innerHTML = `<p class="text-red-500 font-semibold">Could not load events.</p><p class="text-slate-500 text-sm mt-1">Please ensure the Events sheet is published to the web as a CSV file.</p>`;
            }
        }
        
        function renderEvents(events) {
            const gridEl = document.getElementById('events-grid');
            const loadingEl = document.getElementById('events-loading');
            gridEl.innerHTML = '';
            
            if (events.length === 0) {
                loadingEl.innerHTML = '<p>No upcoming events found.</p>';
                return;
            }
            loadingEl.style.display = 'none';

            events.forEach(event => {
                const card = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300">
                        <img src="${event.imageUrl}" 
                             onerror="this.onerror=null;this.src='https://placehold.co/600x400/F97316/FFFFFF?text=Event';"
                             alt="${event.title}" class="w-full h-56 object-cover">
                        <div class="p-6">
                            <p class="text-sm text-ugnt-orange font-semibold">${event.date}</p>
                            <h3 class="font-laila text-xl font-bold text-ugnt-blue mt-2">${event.title}</h3>
                            <p class="text-slate-600 mt-3 text-sm">${event.description}</p>
                        </div>
                    </div>`;
                gridEl.innerHTML += card;
            });
        }

        // --- DIRECTORY LOGIC ---
        let allBusinesses = [];

        async function loadDirectory() {
            const loadingEl = document.getElementById('directory-loading');
            try {
                const response = await fetch(DIRECTORY_CSV_URL);
                if (!response.ok) throw new Error('Network response was not ok.');
                const csvText = await response.text();
                const data = parseCSV(csvText);

                const businesses = data.map(row => ({
                    name: row['Business Name'],
                    owner: row['Owner Name'],
                    contact: row['Contact Info'],
                    description: row['Description'],
                    website: row['Website Link'],
                    category: row['Category'],
                    reviewed: row['Reviewed']
                })).filter(biz => biz.name && biz.reviewed && biz.reviewed.trim().toUpperCase() === 'YES');
                
                allBusinesses = businesses;
                setupDirectory(allBusinesses);
            } catch (error) {
                console.error('Error fetching directory:', error);
                loadingEl.innerHTML = `<p class="text-red-500 font-semibold">Could not load directory.</p><p class="text-slate-500 text-sm mt-1">Please ensure the Directory sheet is published to the web as a CSV file.</p>`;
            }
        }
        
        function setupDirectory(businesses) {
            populateCategoryFilter(businesses);
            renderDirectory(businesses);
            document.getElementById('directory-search').addEventListener('input', filterDirectory);
            document.getElementById('directory-filter').addEventListener('change', filterDirectory);
        }

        function populateCategoryFilter(businesses) {
            const filterEl = document.getElementById('directory-filter');
            const categories = [...new Set(businesses.map(b => b.category).filter(Boolean))];
            categories.sort();
            filterEl.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                filterEl.appendChild(option);
            });
        }
        
        function renderDirectory(businesses) {
            const gridEl = document.getElementById('directory-grid');
            const loadingEl = document.getElementById('directory-loading');
            const noResultsEl = document.getElementById('directory-no-results');
            gridEl.innerHTML = '';
            
            if (businesses.length === 0) {
                noResultsEl.classList.remove('hidden');
                loadingEl.style.display = 'none';
                return;
            }
            
            noResultsEl.classList.add('hidden');
            loadingEl.style.display = 'none';

            businesses.forEach(biz => {
                const websiteLink = biz.website ? `<a href="${biz.website}" target="_blank" rel="noopener noreferrer" class="inline-block mt-4 bg-orange-100 text-ugnt-orange px-4 py-2 rounded-full text-sm font-semibold hover:bg-orange-200 transition">Visit Website</a>` : '';
                const card = `
                    <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col">
                        <h3 class="font-laila text-xl font-bold text-ugnt-blue">${biz.name}</h3>
                        <p class="text-sm text-slate-500 mb-2">Category: ${biz.category}</p>
                        <p class="text-slate-600 mt-2 flex-grow">${biz.description}</p>
                        <div class="mt-4 pt-4 border-t border-slate-200">
                            <p class="font-semibold text-slate-700">${biz.owner}</p>
                            <p class="text-slate-500">${biz.contact}</p>
                        </div>
                        ${websiteLink}
                    </div>`;
                gridEl.innerHTML += card;
            });
        }
        
        function filterDirectory() {
            const searchTerm = document.getElementById('directory-search').value.toLowerCase();
            const selectedCategory = document.getElementById('directory-filter').value;
            
            const filteredBusinesses = allBusinesses.filter(biz => {
                const matchesCategory = !selectedCategory || biz.category === selectedCategory;
                const matchesSearch = !searchTerm || 
                                      (biz.name && biz.name.toLowerCase().includes(searchTerm)) ||
                                      (biz.category && biz.category.toLowerCase().includes(searchTerm)) ||
                                      (biz.description && biz.description.toLowerCase().includes(searchTerm));
                return matchesCategory && matchesSearch;
            });
            
            renderDirectory(filteredBusinesses);
        }

        // --- FORM SUBMISSION LOGIC ---
        async function handleFormSubmit(event) {
            event.preventDefault(); // Prevent the form from reloading the page
            
            const form = event.target;
            const statusDiv = document.getElementById('form-status');
            const submitButton = document.getElementById('submit-button');
            
            if (WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL') {
                statusDiv.textContent = 'Form submission is not configured. Please set the WEB_APP_URL.';
                statusDiv.className = 'mt-6 text-center text-lg text-red-500';
                return;
            }
            
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            statusDiv.textContent = '';

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'cors', 
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8', 
                    },
                    body: JSON.stringify(data),
                    redirect: 'follow'
                });

                if (response.ok || response.type === 'opaque') {
                     statusDiv.textContent = 'Thank you! Your submission has been received and is pending review.';
                    statusDiv.className = 'mt-6 text-center text-lg text-green-600';
                    form.reset();
                } else {
                    const result = await response.json();
                    throw new Error(result.message || 'An unknown error occurred.');
                }

            } catch (error) {
                console.error('Error submitting form:', error);
                if (error.name === 'TypeError') {
                    statusDiv.textContent = 'Thank you! Your submission has been received and is pending review.';
                    statusDiv.className = 'mt-6 text-center text-lg text-green-600';
                    form.reset();
                } else {
                    statusDiv.textContent = 'Sorry, there was an error submitting the form. Please try again later.';
                    statusDiv.className = 'mt-6 text-center text-lg text-red-500';
                }
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Submit for Review';
            }
        }

    </script>
</body>
</html>
